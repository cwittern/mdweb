{% extends "laybase.html" %}
{% import "bootstrap/wtf.html" as wtf %}
{% import "_macros.html" as macros %}


{% block subhead %}

<header class="jumbotron subhead" id="overview">
  <div class="container">
    <h1>{{sr.head}}</h1>

  </div>
</header>


{% endblock subhead %}



{% block body %}

<div>
  <div>
    {{sr.total}}
    {{key}}
    {{_('Showing %d to %d.' % (start, n))}}
    <table>
      {% for item in sr.list %}
      {% set it_txtid = item[1].split(':')[0] %}
      {% set it_juan = item[1].split(':')[1].split('-')[0] %}
      {% set it_page = item[1].split(':')[1].split('-')[1][:-1] + pl[item[1].split(':')[1].split('-')[1][-1]] %}
      {% set it_line = item[1].split(':')[2] %}
      <tr>
<!-- http://localhost:5000/text/ZB6q0003/003#0221a -->
<!-- ZB1a0068:007-352:2:6 -->
	<td class="text-left"><a href="{{url_for('main.showtext', id=it_txtid, juan=it_juan, query=key, _anchor=it_page)}}" title="{{it_txtid}}">{{item[2]['TITLE']}}, {{it_juan.lstrip('0')}}, {{it_page.lstrip('0')}}</a></td>
	<td>{{item[0][1]}}</td><td class="text-left">{{key[0]}}{{item[0][0]}}</td>
      </tr>
    {% endfor %}
    </table>
  </div>
</div>
{% if sr.total > 20 %}
<div class="pagination">
    {{ macros.pagination_widget(pagination, '.searchtext', query=key, filter=filter, count=count) }}
</div>
{% endif %}


{% endblock %}

{% block sidebar %}
<div id="bu"></div>
<hr/>
<div id="lei"></div>
<hr/>
<div id="texts"></div>
{% endblock sidebar %}

{% block closingscript %}
<script>
(function($) {
    $(document).ready(function() {
            $.ajax({
                type: 'GET',
                url: '/getfacets?query={{key}}&len=3&cnt=6',
                dataType: 'html',
                success: function(html, textStatus) {
                    $('#bu').append(html);
                },
                error: function(xhr, textStatus, errorThrown) {
                    alert('An error occurred! ' + ( errorThrown ? errorThrown : xhr.status ));
                }
        });
            $.ajax({
                type: 'GET',
                url: '/getfacets?query={{key}}&len=4&cnt=6',
                dataType: 'html',
                success: function(html, textStatus) {
                    $('#lei').append(html);
                },
                error: function(xhr, textStatus, errorThrown) {
                    alert('An error occurred! ' + ( errorThrown ? errorThrown : xhr.status ));
                }
        });
            $.ajax({
                type: 'GET',
                url: '/getfacets?query={{key}}&len=8&cnt=6',
                dataType: 'html',
                success: function(html, textStatus) {
                    $('#texts').append(html);
                },
                error: function(xhr, textStatus, errorThrown) {
                    alert('An error occurred! ' + ( errorThrown ? errorThrown : xhr.status ));
                }
        });
    });
})(jQuery);


</script>

{% endblock %}
